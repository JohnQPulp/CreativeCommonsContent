<style>
#b-left { background-image: url(/vn/TheSunAlsoRises/images/c-belmonte.webp),url(/vn/TheSunAlsoRises/images/c-count-ehappy-s.webp); }
#b-right { background-image: url(/vn/TheSunAlsoRises/images/c-count-ehappy.webp),url(/vn/TheSunAlsoRises/images/c-belmonte.webp); }
#b-left.ed { background-image: url(/vn/TheSunAlsoRises/images/c-belmonte-xcapeless-xlongjaw.webp),url(/vn/TheSunAlsoRises/images/c-count-ehappy-s.webp); }
#b-right.ed { background-image: url(/vn/TheSunAlsoRises/images/c-count-xroses-ehappy.webp),url(/vn/TheSunAlsoRises/images/c-belmonte-xcapeless-xlongjaw.webp); }
</style>

<p>This is the second in a series of posts explaining my processes for how I convert books into visual novels. See the full series links over on the <a href='https://github.com/JohnQPulp/PublicDomainPulp?tab=readme-ov-file#contributing'>website's README.md</a>.</p>

<p>The overall process I've settled on has four main steps: the first edit, the second edit, the image generation, and the third edit. This post will walk through… none of those, since before we can even start generating a <code>pulp.txt</code> file, we need a good <code>book.txt</code> reference file.</p>

<h2>From .epub to <code>book.txt</code></h2>

<p><code>book.txt</code> is the contents of the to-be-converted source novel in plain text form (with basic markdown annotations). As mentioned in Part 0, this file is what the Pulpifier will use as a reference when building the html from the <code>pulp.txt</code> file, as a check to make sure no accidental text-changing changes were made in the editing process. This is <code>book.txt</code>'s main long-term role, but in the short-term, it's also what we use in the first edit pass to create the starter <code>pulp.txt</code> file.</p>

<p>I use <a href="https://standardebooks.org/">Standard Ebooks</a> .epub files as the basis for all book texts on this site. This isn't a strict requirement — source texts could come from anywhere — but it's convenient to use a single source, where I know the markdown formatting will be consistent: <code>*single asterisks*</code> for italics, <code>**doubled asterisks**</code> for uppercased, <code>## some number of pound signs</code> for different header levels, etc.</p>

<p>Standard Ebooks doesn't provide .txt files directly, but their .epubs are easily convertable with the command <code>pandoc book.epub -t gfm-raw_html --strip-comments --wrap=none -o book.txt</code>. The <code>--wrap=none</code> flag is for making paragraphs take up whole single lines instead of being split up past some character limit. The <code>--strip-comments</code> I'm not sure is strictly necessary, but I set it just in case it applies to the highlights I make while reading. And then the main flag is the <code>-t gfm-raw_html</code>, which gives us the format with the nice markdown.</p>

<p>Well, mostly nice markdown. There is some manual cleanup work that needs to be done, since the Pulpifier can't automatically convert all types of markdown symbols to html, with some of them requiring case-by-case decisions to be made on how best to translate good book formatting into good visual novel formatting. Here are some of the cleanup steps:</p>

<h2><code>book.txt</code> Cleanup</h2>

<p>First, as great as Standard Ebooks is as an organization, their giant Imprint headers and Colophon/Uncopyright footers are always the first thing that needs to go. I do credit them for each book with a link to the source .epub, but the right place for that link is not in the <code>book.txt</code> file itself. In its place, I add a simple one-line header with the book title and author name, such that the beginning of all <code>book.txt</code> files ends up looking something like this:</p>

<pre>
*The Sun Also Rises* by Ernest Hemingway

This book is for **Hadley** and for **John Hadley Nicanor**

“You are all a lost generation.” —Gertrude Stein in conversation

“One generation passeth away, and another generation cometh; but the earth abideth forever ﻿… The sun also ariseth, and the sun goeth down, and hasteth to the place where he arose… The wind goeth toward the south, and turneth about unto the north; it whirleth about continually, and the wind returneth again according to his circuits﻿ ﻿… All the rivers run into the sea; yet the sea is not full; unto the place from whence the rivers come, thither they return again.” —Ecclesiastes

## Book I

### I

Robert Cohn was once middleweight boxing champion of Princeton…
</pre>

<p class='ed'>That'll show you, Standard Ebooks, for trying to tell me not to do evil in your Uncopyright.</p>

<p>That's what the final cleaned-up product looks like. However, there are several markdown shenanigans that can crop up in the pandoc conversion that need special handling. For instance, sometimes chapters generate with custom html annotations like:</p>

<pre>
&lt;hgroup&gt;

## II

The Milkman Sets Out on His Travels

&lt;/hgroup&gt;
</pre>

<p>These need to be collapsed into single lines like:</p>

<pre>## II The Milkman Sets Out on His Travels</pre>

<p>There are also a variety of different formatting situations that put angle brackets at the start of lines, sometimes with additional html, e.g.:</p>

<pre>
&gt; Dear Jake,
&gt;
&gt; We got here Friday, Brett passed out on the train, so brought her here for 3 days rest with old friends of ours. We go to Montoya Hotel Pamplona Tuesday, arriving at I don’t know what hour. Will you send a note by the bus to tell us what to do to rejoin you all on Wednesday. All our love and sorry to be late, but Brett was really done in and will be quite all right by Tues. and is practically so now. I know her so well and try to look after her but it’s not so easy. Love to all the chaps,
&gt;
&gt; &lt;footer role="presentation"&gt;
&gt;
&gt; Michael.
&gt;
&gt; &lt;/footer&gt;
</pre>

<p>Sometimes the brackets represent text with blockquote margins, and sometimes they represent centered text, and sometimes they represent text meant to float right.</p>

<p>Since the bracket-prefixed lines aren't consistent, I always just remove them, and then later on, as part of editing the <code>pulp.txt</code> file, add in spans with helper classes like <code>'center'</code> or <code>'fright'</code>, which the Pulpifier is smart enough to strip out when it comes to the sameness comparison. There are also some custom modifier tags that can be added to metadata that affect presentation. This just comes down to choosing the css that most closely matches the original .epub book look from within the constraints of the visual novel format.</p>

<p>Additionally, sometimes the text, bracket-prefixed or otherwise, is generated without line breaks between lines like:</p>

<pre>
&gt; “One thing’s sure and nothing’s surer  
&gt; The rich get richer and the poor get﻿—children.  
&gt; In the meantime,  
&gt; In between time﻿—”
</pre>

<p>Since the Pulpifier expects a strict text line -> blank line -> repeat 2-cycle sequence for <code>book.txt</code>'s formatting, these need to either have line breaks added, if separate VN-slides are okay, or else merged onto a single line, but with custom <code>&lt;br&gt;</code> tags added in <code>pulp.txt</code>. For this case, since four lines can fit comfortably on one slide, we'd want to collapse it all down into a single line with breaks like this:</p>

<pre>
“One thing’s sure and nothing’s surer&lt;br&gt;The rich get richer and the poor get—children.&lt;br&gt;In the meantime,&lt;br&gt;In between time—”
</pre>

<p>Some other miscallaneous minor fixups that are needed:</p>

<p>Sometimes backslashes appear before certain characters, like dollar signs and square brackets, in the generated text file. These aren't needed, and can all just be deleted.</p>

<p>Sometimes the .epub-to-.txt conversion represents section breaks as super long repeated-dash lines like <code>------------------------------------------------------------------------</code>. These I just consolidate down to a single em dash, which the Pulpifier knows to display as a long dash for that line.</p>

<p>And then some books have other weird niche markdown formattings that need to be fixed up on case-by-case basis. For example, one part of <book>The Great Gatsby</book>'s <code>book.txt</code> generated with a markdown table, which has no meaning to the Pulpifier. Therefore, all the markdown needed to be stripped, just leaving the text, and then again, spans with appropriate css classes picked within <code>pulp.txt</code> so as to as closely match the presentation and intention of the original .epub's presentation. Ultimately going from this:</p>

<pre>
|                                                |           |      |
|------------------------------------------------|-----------|------|
| Rise from bed                                  | 6:00      | a.m. |
| Dumbbell exercise and wall-scaling             | 6:15﻿–﻿6:30 | ”    |
| Study electricity, etc.                        | 7:15﻿–﻿8:15 | ”    |
| Work                                           | 8:30﻿–﻿4:30 | p.m. |
| Baseball and sports                            | 4:30﻿–﻿5:00 | ”    |
| Practise elocution, poise and how to attain it | 5:00﻿–﻿6:00 | ”    |
| Study needed inventions                        | 7:00﻿–﻿9:00 | ”    |

> General Resolves
>
> - No wasting time at Shafters or \[a name, indecipherable\]
>
> - No more smokeing or chewing.
>
> - Bath every other day
>
> - Read one improving book or magazine per week
>
> - Save \$5.00 \[crossed out\] \$3.00 per week
>
> - Be better to parents
</pre>

To this:

<pre>
Rise from bed 6:00 a.m.&lt;br&gt;Dumbbell exercise and wall-scaling 6:15﻿–﻿6:30 ”&lt;br&gt;Study electricity, etc. 7:15﻿–﻿8:15 ”&lt;br&gt;Work 8:30﻿–﻿4:30 p.m.&lt;br&gt;Baseball and sports 4:30﻿–﻿5:00 ”&lt;br&gt;Practise elocution, poise and how to attain it 5:00﻿–﻿6:00 ”&lt;br&gt;Study needed inventions 7:00﻿–﻿9:00 ”

General ResolvesNo wasting time at Shafters or [a name, indecipherable]&lt;br&gt;No more smokeing or chewing.&lt;br&gt;Bath every other day&lt;br&gt;Read one improving book or magazine per week&lt;br&gt;Save $5.00 [crossed out] $3.00 per week&lt;br&gt;Be better to parents
</pre>

<p class='ed'>God it's stupid having br-tags in the <code>book.txt</code>. It really would be so much cleaner to make custom html formatting entirely take place within the <code>pulp.txt</code> files, but that would necessarily increase parsing complexity in some way, since you'd be breaking the main 2-cycle assumption of paragraph line -> blank line -> repeat, which would be a long-term maintenance annoyance. But this current setup is also annoying. Ah well.</span>

<p>…With the necessary html div and span classes added in matching <code>pulp.txt</code> file, which happens later on, but ultimately ends up looking like:<p>

<pre>
Rise from bed &lt;span class='fright'&gt;6:00 a.m.&lt;/span&gt;&lt;br&gt;Dumbbell exercise and wall-scaling &lt;span class='fright'&gt;6:15﻿–﻿6:30 ”&lt;/span&gt;&lt;br&gt;Study electricity, etc. &lt;span class='fright'&gt;7:15﻿–﻿8:15 ”&lt;/span&gt;&lt;br&gt;Work &lt;span class='fright'&gt;8:30﻿–﻿4:30 p.m.&lt;/span&gt;&lt;br&gt;Baseball and sports &lt;span class='fright'&gt;4:30﻿–﻿5:00 ”&lt;/span&gt;&lt;br&gt;Practise elocution, poise and how to attain it &lt;span class='fright'&gt;5:00﻿–﻿6:00 ”&lt;/span&gt;&lt;br&gt;Study needed inventions &lt;span class='fright'&gt;7:00﻿–﻿9:00 ”&lt;/span&gt;
m=margin

&lt;div class='upper center'&gt;General Resolves&lt;/div&gt;No wasting time at Shafters or [a name, indecipherable]&lt;br&gt;No more smokeing or chewing.&lt;br&gt;Bath every other day&lt;br&gt;Read one improving book or magazine per week&lt;br&gt;Save $5.00 [crossed out] $3.00 per week&lt;br&gt;Be better to parents
</pre>

<p>And that all may seem like a lot of cleanup (with rather less-readable results), but ultimately these are the exception cases, and the overall consistent and well-vetted formattings of the Standard Ebooks .epub files makes this bit of overhead work still the least time-consuming option. Especially once you factor in that, for some of these cases, there's no way to avoid some necessary manual cleanup work, so as to make the formatting fit well in visual novel form.</p>

<h2>Next Steps</h2>

<p>That accomplished then, the <code>book.txt</code> is then ready for processing — ready for turning into an actual visual novel. In the next part, I'll walk through the first real step of that process — the first edit — which involves creating a <code>pulp.txt</code> file out of <code>book.txt</code> with name metadata, speaker metadata, expression metadata, and VN-friendly line breaks.</p>
