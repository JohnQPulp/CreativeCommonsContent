<style>
#b-right { background-image: url(/vn/TheSunAlsoRises/images/c-romero.webp),url(/vn/TheSunAlsoRises/images/c-author.webp); }
#b-left { background-image: url(/vn/TheSunAlsoRises/images/c-author.webp),url(/vn/TheSunAlsoRises/images/c-romero-esmirking-s.webp); }
#b-right.ed { background-image: url(/vn/TheSunAlsoRises/images/c-romero-xblack-xcapeless-ehappy-s.webp),url(/vn/TheSunAlsoRises/images/c-author-abased.webp); }
#b-left.ed { background-image: url(/vn/TheSunAlsoRises/images/c-author-abased.webp),url(/vn/TheSunAlsoRises/images/c-romero-xblack-eserious.webp); }
</style>

<p>This will be the first in a series of posts explaining my processes for how I convert books into visual novels.</p>

<p>The post date above represents the publication date of this entry's first draft, but I intend the posts of this series to all be living documents, continually updated over time as I figure out better and more efficient techniques, both on the manual and automation side of things.</p>

<p>For this first entry, I'll go into not the processes themselves, but the prerequisite for understanding them: the <code>pulp.txt</code> file, the "code" underlying each visual novel.</p>

<img alt="Example Visual Novel Github repo" src="/images/github.webp" />

<p>Each visual novel repo contains a <code>pulp.txt</code> file and a <code>book.txt</code> file, which are together consumed by the <a href="https://github.com/JohnQPulp/Pulpifier">Pulpifier</a> in order to build the VN-formatted html output.</p>

<p>The <code>book.txt</code> is essentially just the original text of the book, the output of pandoc-converting a Standard Ebooks .epub into a .txt file. (Using the <code>gfm-raw_html</code> target format, along with some other flags, and also some manual cleanup, that I'll all describe in more detail in the next part.)</p>

<p>Here's a <code>book.txt</code> example snippet:</p>

<pre>
### VII

As I started up the stairs the concierge knocked on the glass of the door of her lodge, and as I stopped she came out. She had some letters and a telegram.

“Here is the post. And there was a lady here to see you.”

“Did she leave a card?”

“No. She was with a gentleman. It was the one who was here last night. In the end I find she is very nice.”

“Was she with a friend of mine?”

“I don’t know. He was never here before. He was very large. Very, very large. She was very nice. Very, very nice. Last night she was, perhaps, a little﻿—” She put her head on one hand and rocked it up and down. “I’ll speak perfectly frankly, Monsieur Barnes. Last night I found her not so *gentille*. Last night I formed another idea of her. But listen to what I tell you. She is *très, très gentille*. She is of very good family. It is a thing you can see.”

“They did not leave any word?”

“Yes. They said they would be back in an hour.”

“Send them up when they come.”

“Yes, Monsieur Barnes. And that lady, that lady there is someone. An eccentric, perhaps, but *quelqu’une, quelqu’une*!”
</pre>

<p>The main features to note are that:</p>

<ul>
<li>The file alternates between text lines and blank lines.</li>
<li>Each text line represents one paragraph.</li>
<li>Raw markdown symbols are included, such as <code>*italics*</code> and <code>## Headings</code>.</li>
</ul>

<p>The <code>book.txt</code> file is the reference file — the source of truth that the Pulpifier compares the <code>pulp.txt</code> file against. The corresponding <code>pulp.txt</code> snippet for this chunk is:</p>

<pre>
### VII
r=title

As I started up the stairs the concierge knocked on the glass of the door of her lodge, and as I stopped she came out.
b=flat-concierge-int

She had some letters and a telegram.
n:concierge1=Concierge;c=concierge1;e:concierge1=happy

“Here is the post. And there was a lady here to see you.”
s=concierge1

“Did she leave a card?”
s=jake

“No. She was with a gentleman. It was the one who was here last night. In the end I find she is very nice.”
s=concierge1;e:concierge1=happy

“Was she with a friend of mine?”
s=jake

“I don’t know. He was never here before. He was very large. Very, very large.”
s=concierge1

“She was very nice. Very, very nice.”


“Last night she was, perhaps, a little—”
e:concierge1=thinking

She put her head on one hand and rocked it up and down.
s=none;c=

“I’ll speak perfectly frankly, Monsieur Barnes. Last night I found her not so *gentille*. Last night I formed another idea of her.”
s=concierge1;e:concierge1=serious;c=concierge1

“But listen to what I tell you. She is *très, très gentille*. She is of very good family. It is a thing you can see.”
e:concierge1=happy

“They did not leave any word?”
s=jake;e:jake=contemplative

“Yes. They said they would be back in an hour.”
s=concierge1

“Send them up when they come.”
s=jake

“Yes, Monsieur Barnes. And that lady, that lady there is someone. An eccentric, perhaps, but *quelqu’une, quelqu’une*!”
s=concierge1;e:concierge1=happy
</pre>

<p>Note how the <code>pulp.txt</code> file:</p>

<ul>
<li>Alternates text line, metadata line, blank line; repeat. So a 3-cycle instead of <code>book.txt</code>'s 2-cycle.</li>
<li>Contains the exact<a href="#quote-handling">*</a> same text content, including the same markdown, as <code>book.txt</code>. (One of the functions of the Pulpifier is to check the combined text contents of <code>pulp.txt</code> against <code>book.txt</code> to make sure no transcription or editing mistakes accidentally changed the original text.)</li>
<li>Contains more lines than the original <code>book.txt</code>, despite containing the same overall text. For while <code>book.txt</code>'s lines represent whole paragraphs, <code>pulp.txt</code>'s lines represent individual slides of the visual novel. Thus, for visual presentation purposes, we want long paragraphs split up.</li>
</ul>

<p>The text lines and their associated metadata define all aspects of the visual novel's presentation. In this case, one example slide looks like this:</p>

<img alt="Visual novel example slide" src="/images/slide.webp" />

<p>This fifth line of the example snippet can be explained as a combination of the text of that particular line along with its line metadata and the 4 lines of metadata before it. Walking through this specific example will help give a high-level overview of how the <code>pulp.txt</code> format with its metadata tags works, before going into the specific documentation of each tag.</p>

<ul>
<li>The first line's <code>r=title</code> uses the (r)eset tag to reset most metadata to its default state. This is important because certain metadata carries over from line-to-line, and so you'll usually see the resets at the beginning of each chapter, as those act as clear refresh points. The <code>=title</code> part is the tag telling the VN to use the title-card background for the chapter header line.</li>
<li>The second line's <code>b=flat-concierge-int</code> uses the (b)ackground tag to set the VN to the interior flat lobby background. (r)eset and (b)ackground both set a background, but (b)ackground only sets the background — it doesn't affect any other metadata. Either way, once the background has been set, it stays with that background until changed again. So since none of the subsequent lines change the background, it's that same background that the 5th line will end up using.</li>
<li>The third line's <code>n:concierge1=Concierge;c=concierge1;e:concierge1=happy</code> uses three new tags (separated by semicolons, which act as the tags' dividors) to do the following things:
<ul>
<li><code>n:concierge1=Concierge</code> uses the (n)ame tag to define a new character with the ID <code>concierge1</code> with the user-displayed name of "Conierge".</li>
<li><code>c=concierge</code> uses the (c)haracter tag to set <code>concierge1</code> as the on-screen character.</li>
<li><code>e:concierge1=happy</code> uses the (e)xpression tag to set <code>concierge1</code>'s state to <code>happy</code>, such that while on-screen, her appearance will use her "happy" sprite set.</li>
</ul>
</li>
<li><code>s=concierge1</code> uses the (s)peaker tag to set the speaker to <code>concierge1</code>. During this line, her name will appear on-screen as the speaker and her character will use a speaking sprite (<code>c-concierge-ehappy-s.webp</code>, taking into account the previous line).</li>
<li><code>s=jake</code> updates the speaker to <code>jake</code>, a character defined in a previous chapter (who therefore doesn't need to be redefined). Since his character isn't on-screen, he'll appear in the lower-left corner "speaker box", where he can be seen in his neutral speaking expression, since no specific expression was set.</li>
</ul>

<p>All together, you can see how the relatively simple metadata annotations of the <code>pulp.txt</code> file can fully control the appearance of the book's visual novel.</p>

<p>And simplicity is the main goal of the format: text files are simple to read, simple to edit, simple to commit and diff, and simple to <i>generate</i>. (In subsequent parts, I'll discuss the role of LLMs in visual novel creation.)</p>

<p>So jumping off from this example, let's go through each <code>pulp.txt</code> metadata tag in detail:</p>

<h1>The Metadata Tag Lines</h1>

<p>The overall format for the metadata tags is <code>k=value</code> or <code>k:name=value</code> or <code>k=val1,val2,…,valN</code> or <code>k:name=val1,val2,…,valN</code>.</p>

<p><code>k</code> is the tag key, a single-letter identifier for which tag is being set e.g., <code>b</code> for background or <code>c</code> for characters. Some tags like background accept a single value argument (you can only set one background at-a-time), whereas others like characters can accept one or many or even zero (e.g., <code>c=belmonte,romero,marcial</code> sets three characters to be on-screen at once).</p>

<p>Some tags like <code>e</code> (expression) take a required <code>name</code> parameter as the first argument, written like <code>e:romero=happy</code>. These name-requiring parameters tags can also set multiple values, like the <code>z</code> (zoom) tag for setting character sprite positioning metadata e.g., <code>z:hubertfather=94,49,3</code>. Functionally, there isn't really difference between the name-requiring and non-name-requiring tags except insofar as how they're written. Theoretically the format could instead be <code>e=romero,happy</code> and <code>z=hubertfather,94,49,3</code>, and they'd still just be tags accepting arguments like the others, but having the names be a visually distinct first parameter helps improve readability.</p>

<p>Metadata lines are made up of sets of metadata tags, ranging from zero to many per line, separated by semicolons. A valid metadata line might be completely blank, or it might have lots of delimited tags like:</p>

<pre>s=bill;e:bill=;c=bill;v=100,115;z:bill=103</pre>

<p>The tags are read left-to-right, and processed in that order, so if for whatever reason a metadata line sets the same tag twice like <code>s=bill;s=jake</code>, it's the second value that wins out. (Though there isn't any reason to do this in practice, and I might change it to just be a parsing error later on.)</p>

<p>Now let's go through all the individual tags and explain how they work and how they relate to each other and the text lines:</p>

<h2>(b)ackground</h2>

<p><code>b</code> accepts exactly one argument, setting the background like <code>b=flat-ext</code>. This presumes the existance of a background image file named <code>b-flat-ext.webp</code>.</p>

<p>The set background will remain the active background until changed by a subsequent <code>b</code> or <code>r</code> tag.</p>

<h2>(n)ame</h2>

<p><code>n</code> accepts two arguments, a character identifier and a display name e.g., <code>n:mike=Michael Campbell</code>. This acts as the declaration of a new character, allowing the identifier to be used in subsequent tags. (Which otherwise throw undeclared identifier errors.)</p>

<p>An identifier cannot be undeclared, but the display name can be changed over time, if for example a character's name is revealed in stages. You might have the display start off as <code>n:jake=?</code> for an unnamed character, then switch to <code>n:jake=Jake</code> once you learn their first name, and then finally <code>n:jake=Jake Barnes</code>.</p>

<h2>(c)haracters</h2>

<p><code>c</code> accepts zero-to-five arguments, establishing which all characters are on-screen. If for example you set <code>c=jake</code>, then the VN will display the <code>c-jake.webp</code> sprite centered horizontally on top of the background.</p>

<p>Providing zero arguments like <code>c=</code> removes all on-screen characters.</p>

<p>Providing more than one argument like <code>c=jake,brett</code> positions characters using a slot system where, given N arguments, the character in slot X is positioned at X/(N+1) of the way horizontally on the screen. In this case, <code>jake</code> in slot 1 is positioned at the 1/3 horizontal position, and <code>brett</code> in slot 2 is set at the 2/3 position. With five slots, any fractional position up to denominator of 6 is allowed. It's even possible to leave slots empty like <code>c=,,brett</code>, which puts <code>brett</code> at the 3/4 position, leaving the 1/4 and 2/4 positions unfilled. In this way, along with the <code>v</code> tag, the positioning of on-screen characters can be controlled.</p>

<h2>(o)bject</h2>

<p><code>o</code> accepts zero or one arguments, placing an object sprite on screen like <code>o=trout</code> for <code>o-trout.webp</code>. Unlike backgrounds, objects don't cover the whole screen, but sit, horizontally centered, on top of both the background and characters. Like with backgrounds, they stay on-screen until another <code>o</code> tag is set, either switching to a different object, or removing any object via <code>o=</code>.</p>

<h2>(e)xpression</h2>

<p></p>

<h2>(a)ge</h2>

<p></p>

<h2>e(x)tras</h2>

<p></p>

<h2>(s)peaker</h2>

<p></p>

<h2>(t)hinker</h2>

<p></p>

<h2>(z)oom</h2>

<p></p>

<h2>(v)iew</h2>

<p></p>

<h2>(f)ilter</h2>

<p></p>

<h2>(m)odifier</h2>

<p></p>

<h2>(h)eader</h2>

<p></p>

<h2>(r)eset</h2>

<p></p>

<h1>The Text Lines</h1>

<p></p>

<h2>Line Formats</h2>

<p></p>

<h2 id="line-break-rules">Line Break Rules</h2>

<p></p>

<h2 id="quote-handling">Quote Handling</h2>

<p></p>

<h2>Html Handling</h2>

<p></p>

<h2>Editor's Notes</h2>

<p></p>
